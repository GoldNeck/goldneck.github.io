---
layout: post
title:  "소트조인(4/4)"
summary: "Sort 연산 시 메모리 내 최적화. "
author: goldtree
date: '2024-10-14 20:02:12 +0900'
category: 'sql_tuning'
tags: DB
#thumbnail: /assets/img/posts/index_3.jpg
isShowThumbnail: false
keywords: Sort Area, Top N 알고리즘, 소트 부하, Physical I/O, 윈도우 함수, rank, row_number, 메모리 최적화, 분석 함수, 디스크 I/O
usemathjax: false
permalink: /blog/sortjoin_4/
---

## 5.4 Sort Area 적게 사용하도록 SQL작성

Sort 연산이 불가피하다면 메모리 내에서 처리를 완료할 수 있도록 노력한다. Sort Area 크기를 늘리는 방법도 있지만,  
그전에 Sort Area를 적게 사용할 방법을 생각해야함.  

### 5.4.2 Top N 쿼리의 소트 부하 경감 원리

Top N  소트 알고리즘 사용해야 Sort Area 사용량이 준다.  

10개 배열을 담은 다음 오름차순 정렬 → 이후 레코드 값을 배열 맨 끝 값과 비교 → 기존에 맨 끝 값은 버린다.  

Top N 소트 알고리즘을 사용하면 Physical Read, Physical Write 가 발생하지 않는다.  

### 5.4.3 Top N 쿼리가 아닐때 소트 부하

실행계획에서 Stopkey없으면, Top N 소트 알고리즘이 사용되지 않는다는 뜻.  

디스크 I/O가 발생되어 소트 알고리즘을 사용못해 디스크 I/O(pr, pw가 발생)가 발생한다.  

### 5.4.4 분석함수에서의 TOP N 소트

윈도우 함수 중 rank나 row_number 함수는 max 함수보다 소트 부하가 적음. (Top N 알고리즘 작동 함)  